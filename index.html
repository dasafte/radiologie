
<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8">
  <title>Simulare Radiologie</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .question { border: 1px solid #ccc; padding: 15px; margin-bottom: 20px; border-radius: 10px; }
    .image { margin: 10px 0; max-width: 100%; height: auto; }
    .correct { background-color: #c8f7c5; }
    .incorrect { background-color: #f7c5c5; text-decoration: line-through; }
    .missed { background-color: #d9edf7; font-weight: bold; }
    .single { color: #0066cc; font-weight: bold; }
    .multi { color: #cc6600; font-weight: bold; }
    button { padding: 10px 20px; margin-right: 10px; }
  </style>
</head>
<body>
  <h1>Simulare Radiologie – 32 întrebări</h1>
  <button onclick="generateTest()">Generează Testul</button>
  <button onclick="submitTest()">Trimite Testul</button>
  <p id="progres"></p>
  <div id="container"></div>
  <script>
    let questions = [], test = [], usedIndexes = [], fullSetUsed = false;

    fetch("radiologie.json")
      .then(res => res.json())
      .then(data => {
        questions = data;
        alert("Fișierul radiologie.json a fost încărcat cu succes.");
      })
      .catch(err => alert("Eroare la încărcarea întrebărilor: " + err));

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    function generateTest() {
      if (!questions.length) return alert("Încă nu s-au încărcat întrebările.");
      document.getElementById("container").innerHTML = "";
      test = [];
      let singles = questions
        .map((q, i) => ({ q, i }))
        .filter(obj => !usedIndexes.includes(obj.i) && obj.q.answers.filter(a => a.is_correct).length === 1);
      let multis = questions
        .map((q, i) => ({ q, i }))
        .filter(obj => !usedIndexes.includes(obj.i) && obj.q.answers.filter(a => a.is_correct).length >= 2 && obj.q.answers.filter(a => a.is_correct).length <= 4);

      shuffle(singles);
      shuffle(multis);

      if (singles.length < 16 || multis.length < 16) {
        usedIndexes = [];
        fullSetUsed = true;
        alert("Ai parcurs toate cele 150 de întrebări. Se reîncepe de la început.");
        
    alert("Apasă din nou pe 'Generează Testul' pentru a începe un nou set de întrebări.");
    return;
    
      }

      let selected = singles.slice(0, 16).concat(multis.slice(0, 16));
      shuffle(selected);
      test = selected;

      test.forEach((item, i) => {
        usedIndexes.push(item.i);
        const div = document.createElement("div");
        div.className = "question";
        const tip = item.q.answers.filter(a => a.is_correct).length === 1 ? "single" : "multi";
        div.innerHTML = `<div class="${tip}">${i + 1}. ${item.q.question}</div>` +
                        `<img src="img/${item.q.image}" class="image" onerror="this.style.display='none';">`;

        item.q.answers.forEach((a, j) => {
          const id = `q${i}_a${j}`;
          div.innerHTML += `<label id="label_${id}"><input type="checkbox" id="${id}"> ${a.text}</label><br>`;
        });

        document.getElementById("container").appendChild(div);
      });

      document.getElementById("progres").innerText = `Întrebări parcurse: ${usedIndexes.length} din 150`;
    }

    function submitTest() {
      test.forEach((item, i) => {
        const q = item.q;
        q.answers.forEach((a, j) => {
          const id = `q${i}_a${j}`;
          const cb = document.getElementById(id);
          const label = document.getElementById("label_" + id);
          if (cb.checked && a.is_correct) {
            label.classList.add("correct");
          } else if (cb.checked && !a.is_correct) {
            label.classList.add("incorrect");
          } else if (!cb.checked && a.is_correct) {
            label.classList.add("missed");
          }
        });
      });
      alert("Evaluare completă. Verifică răspunsurile evidențiate.");
    }
  </script>
</body>
</html>
